# Stage 1: Build dev image
FROM node:22-alpine

# Set working directory
WORKDIR /app

# Copy package files and install all dependencies (including dev)
COPY package*.json ./
RUN npm install --ignore-scripts

# Copy all source code
COPY . .

# Generate Prisma client and build TypeScript
RUN npm run prisma:generate

# Expose port for testing if needed
EXPOSE 3000

# Default command can be overridden by CI to run tests
CMD ["npm", "test"]
